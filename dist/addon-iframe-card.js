(function(n){typeof define=="function"&&define.amd?define(n):n()})(function(){"use strict";const n=window.loadCardHelpers,_=async(t,e)=>{let s=null;try{s=await t.callWS({type:"supervisor/api",endpoint:`/addons/${e}/info`,method:"get"})}catch{}return s},f=async t=>{const s=(await t.callWS({type:"supervisor/api",endpoint:"/ingress/session",method:"post"})).session;return document.cookie=`ingress_session=${s};path=/api/hassio_ingress/;SameSite=Strict${location.protocol==="https:"?";Secure":""}`,s},u=async(t,e)=>{await t.callWS({type:"supervisor/api",endpoint:"/ingress/validate_session",method:"post",data:{session:e}})},h="hui-iframe-card",d="iframe",m="addon-iframe-card",c="custom:addon-iframe-card";let l;(async()=>{let t=customElements.get(h);t===void 0&&((await n()).createCardElement({type:d}),await customElements.whenDefined(h),t=customElements.get(h)),l=t})();class p extends HTMLElement{static async getConfigElement(){return await l.getConfigElement()}static getStubConfig(){const e=l.getStubConfig();return e.type=c,e}disconnectedCallback(){this._sessionKeepAlive&&clearInterval(this._sessionKeepAlive)}set hass(e){this._iframe?this._iframe.hass=e:(this._hass=e,this._config&&this._config.type===c&&this._setConfig(e,this._config))}get hass(){return this._iframe?this._iframe.hass:this._hass}set layout(e){this._iframe?this._iframe.layout=e:this._layout=e}get layout(){return this._iframe?this._iframe.layout:this._layout}getCardSize(){return this._iframe?this._iframe.getCardSize():5}setConfig(e){if(!e.url)throw new Error("URL required");const s=this.hass;s?this._setConfig(s,e):this._config=e}async _setConfig(e,s){if(s=(()=>{const{type:i,...a}=s;return(!this._config||this._config.type===c)&&(this._config={type:d}),Object.assign(this._config,a)})(),await this._fixConfig(e,s)){if(this._sessionKeepAlive===void 0){let i;try{i=await f(e)}catch{throw new Error("Unable to create an Ingress session")}this._sessionKeepAlive=window.setInterval(async()=>{const a=this.hass;try{await u(a,i)}catch{i=await f(a)}},6e4)}}else this._sessionKeepAlive&&clearInterval(this._sessionKeepAlive);await this._updateIframe(s)}async _fixConfig(e,s){const o=s.url.match(/^([\w-]+)(?:$|\/)(.*)/);if(!o)return"";const[,i,a]=o,r=await _(e,i);if(!r)throw new Error(`Unable to fetch add-on info of '${i}'`);if(!r.ingress_url)throw new Error(`Add-on '${i}' does not support Ingress`);return s.url=`${r.ingress_url.replace(/\/+$/,"")}/${a}`,i}async _updateIframe(e){let s=this._iframe;s?s.setConfig(e):(this._iframe=(await n()).createCardElement(e),s=this._iframe,this.appendChild(s),this._layout!==void 0&&(s.layout=this._layout,delete this._layout),this._hass&&(s.hass=this._hass,delete this._hass))}}customElements.define(m,p)});
